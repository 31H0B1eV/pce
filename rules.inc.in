# Makefile include file
# $Id$


VPATH = $(srcdir) $(topdir)/src


#-----------------------------------------------------------------------------

all: subdirs


subdirs: subdirs-rec
subdirs-rec:
ifneq "$(subdir)" ""
	@for dir in $(subdir); do \
		(cd $$dir && $(MAKE) $(MAKE_FLG)); \
	done
endif


#-----------------------------------------------------------------------------

clean: clean-rec clean-files

clean-files:
ifneq "$(CLN)" ""
	rm -f $(CLN)
endif

clean-rec:
ifneq "$(subdir)" ""
	@for dir in $(subdir); do \
		(cd $$dir && $(MAKE) $(MAKE_FLG) clean); \
	done
endif


#-----------------------------------------------------------------------------

distclean: distclean-rec distclean-files

distclean-files:
ifneq "$(CLN)" ""
	rm -f $(CLN)
endif
ifneq "$(DCL)" ""
	rm -f $(DCL)
endif

distclean-rec:
ifneq "$(subdir)" ""
	@for dir in $(subdir); do \
		(cd $$dir && $(MAKE) $(MAKE_FLG) distclean); \
	done
endif


#-----------------------------------------------------------------------------

install: install-rec
install-rec:
ifneq "$(subdir)" ""
	@for dir in $(subdir); do \
		(cd $$dir && $(MAKE) $(MAKE_FLG) install); \
	done
endif

install-bin:
ifneq "$(BIN)" ""
	$(INSTALL) -d -m 755 $(DESTDIR)$(bindir)
	for f in $(BIN) ; do \
		$(INSTALL) -m 755 -s $$f $(DESTDIR)$(bindir) ; \
	done
endif

install-bins:
ifneq "$(BINS)" ""
	$(INSTALL) -d -m 755 $(DESTDIR)$(bindir)
	for f in $(BINS) ; do \
		$(INSTALL) -m 755 $$f $(DESTDIR)$(bindir) ; \
	done
endif

install-man:
ifneq "$(MAN1)" ""
	$(INSTALL) -d -m 755 $(DESTDIR)$(mandir)/man1
	for f in $(MAN1) ; do \
		$(INSTALL) -m 644 $(srcdir)/$$f $(DESTDIR)$(mandir)/man1 ; \
	done
endif


#-----------------------------------------------------------------------------

%.o: %.c
	$(QP)echo "  CC     $@"
	$(QR)$(CC) -c $(CC_FLG) $(CC_FLG_EXTRA) -o $@ $<

%.a:
	$(QP)echo "  AR     $@"
	$(QR)rm -f $@
	$(QR)$(AR) $(AR_FLG) $@ $^
