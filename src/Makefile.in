# Makefile
# $Id: Makefile.in,v 1.6 2003/04/22 17:56:19 hampa Exp $

srcdir := @srcdir@
topdir := @top_srcdir@
subdir := bios e8086 e8255 e8259 libini
reldir := ..

include $(reldir)/Makefile.inc


SRC	:= cga.c floppy.c ibmpc.c keyboard.c mda.c memory.c pce.c term.c

OBJ	:= cga.o floppy.o ibmpc.o keyboard.o mda.o memory.o pce.o term.o
OBJ_EXT	:= e8086/e8086.a e8255/e8255.a e8259/e8259.a libini/libini.a

HDR	:= cga.h floppy.h ibmpc.h keyboard.h mda.h memory.h pce.h term.h
HDR_EXT	:= e8086/e8086.h e8255/e8255.h e8259/e8259.h libini/libini.h

MAN	:=

BIN	:= pce

SDP	:= Makefile $(HDR) $(HDR_EXT)
BDP	:= Makefile $(OBJ) $(OBJ_EXT)


all: $(BIN) $(OBJ)


clean:
	rm -f $(OBJ) $(BIN)


install:
	$(INSTALL) -d -m 755 $(bindir)
	$(INSTALL) -d -m 755 $(etcdir)
	$(INSTALL) -m 755 -s $(BIN) $(bindir)
	$(INSTALL) -m 644 $(srcdir)/pce.cfg $(etcdir)
ifneq "$(MAN)" ""
	$(INSTALL) -d -m 755 $(mandir)/man1
	for f in $(MAN) ; do \
		rm -f $(mandir)/man1/$$f.gz ; \
		gzip -c --best $(srcdir)/$$f > $(mandir)/man1/$$f.gz ; \
	done
endif


pce: $(OBJ) $(OBJ_EXT)
	$(LD) $(LD_FLG) -o $@ $(OBJ) $(OBJ_EXT)


cga.o:		cga.c $(SDP)
floppy.o:	floppy.c $(SDP)
ibmpc.o:	ibmpc.c $(SDP)
keyboard.o:	keyboard.c $(SDP)
mda.o:		mda.c $(SDP)
memory.o:	memory.c $(SDP)
pce.o:		pce.c $(SDP)
term.o:		term.c $(SDP)
