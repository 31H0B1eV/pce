# src/arch/macplus/Makefile

srcdir := @srcdir@
topdir := @top_srcdir@
subdir :=
reldir := ../../..

pcesrc := $(topdir)/src
pcedst := $(reldir)/src


include $(reldir)/config.inc


CC_FLG += -I$(srcdir)


FILES := \
	cmd_68k \
	hook \
	iwm \
	keyboard \
	macplus \
	main \
	mem \
	msg \
	rtc \
	scsi \
	serial \
	sony \
	traps \
	video

SRC := $(foreach f,$(FILES),$(f).c)
OBJ := $(foreach f,$(FILES),$(f).o)
HDR := $(foreach f,$(FILES),$(f).h)

LIB := $(PCE_CHAR_LIB)

OBJ_EXT := \
	$(pcedst)/cpu/e68000/e68000.a \
	$(pcedst)/chipset/82xx/e8250.o \
	$(pcedst)/chipset/e6522.o \
	$(pcedst)/chipset/e8530.o \
	$(pcedst)/devices/device.o \
	$(pcedst)/devices/memory.o \
	$(pcedst)/devices/slip.o \
	$(pcedst)/lib/brkpt.o \
	$(pcedst)/lib/cmd.o \
	$(pcedst)/lib/console.o \
	$(pcedst)/lib/hexdump.o \
	$(pcedst)/lib/inidsk.o \
	$(pcedst)/lib/iniram.o \
	$(pcedst)/lib/initerm.o \
	$(pcedst)/lib/ihex.o \
	$(pcedst)/lib/srec.o \
	$(pcedst)/lib/load.o \
	$(pcedst)/lib/log.o \
	$(pcedst)/lib/monitor.o \
	$(pcedst)/lib/msg.o \
	$(pcedst)/lib/path.o \
	$(pcedst)/lib/sysdep.o \
	$(pcedst)/libini/libini.a \
	$(PCE_BLK_OBJ) \
	$(PCE_CHAR_OBJ) \
	$(PCE_TERM_OBJ)


HDR_EXT := \
	$(pcedst)/config.h \
	cpu/e68000/e68000.h \
	chipset/82xx/e8250.h \
	chipset/e6522.h \
	chipset/e8530.h \
	devices/device.h \
	devices/memory.h \
	devices/slip.h \
	lib/brkpt.h \
	lib/cmd.h \
	lib/console.h \
	lib/hexdump.h \
	lib/inidsk.h \
	lib/iniram.h \
	lib/initerm.h \
	lib/ihex.h \
	lib/srec.h \
	lib/load.h \
	lib/log.h \
	lib/monitor.h \
	lib/msg.h \
	lib/path.h \
	lib/sysdep.h \
	libini/libini.h \
	$(PCE_BLK_HDR) \
	$(PCE_CHAR_HDR) \
	$(PCE_TERM_HDR)

ifeq "$(PCE_ENABLE_TUN)" "1"
	OBJ_EXT += $(pcedst)/lib/tun.o
	HDR_EXT += lib/tun.h
endif

ifeq "$(PCE_X11_USE)" "1"
	CC_FLG_EXTRA += $(PCE_X11_CCF)
	LD_FLG_EXTRA += $(PCE_X11_LDF)
endif

ifeq "$(PCE_SDL_USE)" "1"
	CC_FLG_EXTRA += $(PCE_SDL_CCF)
	LD_FLG_EXTRA += $(PCE_SDL_LDF)
endif

MAN1 :=

BIN := pce-macplus

SDP := Makefile $(HDR) $(HDR_EXT)
BDP := Makefile $(OBJ) $(OBJ_EXT)

CLN := $(BIN) $(OBJ) macplus.cfg
DCL := Makefile

DIST := $(SRC) $(HDR) $(MAN1) Makefile.in macplus.cfg.in


include $(reldir)/rules.inc


all: $(BIN) $(OBJ) pce-macplus.cfg


install: install-bin pce-macplus.cfg
	$(QR)$(INSTALL) -d -m 755 $(DESTDIR)$(etcdir)
	$(QP)echo "  CP     pce-macplus.cfg"
	$(QR)test -f $(DESTDIR)$(etcdir)/pce-macplus.cfg || $(INSTALL) -m 644 pce-macplus.cfg $(DESTDIR)$(etcdir)


pce-macplus: $(OBJ) $(OBJ_EXT)
	$(QP)echo "  LD     $@"
	$(QR)$(LD) $(LD_FLG) -o $@ $(OBJ) $(OBJ_EXT) $(LIB) $(LD_FLG_EXTRA)


pce-macplus.cfg: macplus.cfg.in
	$(QP)echo "  SED    $@"
	$(QR)sed -e "s]PCE_DIR_DATA]$(datdir)]g" < $< > $@


cmd_68k.o:	cmd_68k.c $(SDP)
hook.o:		hook.c $(SDP)
iwm.o:		iwm.c $(SDP)
keyboard.o:	keyboard.c $(SDP)
macplus.o:	macplus.c $(SDP)
main.o:		main.c $(SDP)
mem.o:		mem.c $(SDP)
msg.o:		msg.c $(SDP)
rtc.o:		rtc.c $(SDP)
scsi.o:		scsi.c $(SDP)
serial.o:	serial.c $(SDP)
sony.o:		sony.c $(SDP)
traps.o:	traps.c $(SDP)
video.o:	video.c $(SDP)
