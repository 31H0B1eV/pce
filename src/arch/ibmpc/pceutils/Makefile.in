# Makefile
# $Id$

srcdir := @srcdir@
topdir := @top_srcdir@
subdir :=
reldir := ../../../..


include $(reldir)/config.inc


BASECOM := pceboot pceexit pcemsg pcestop pcetime pcever
BASESYS := pceemm pcehimem

SRC := $(foreach f,$(BASECOM) $(BASESYS),$(f).asm)
HDR :=
MAN :=
BIN := $(foreach f,$(BASECOM),$(f).com)
BIN += $(foreach f,$(BASESYS),$(f).sys)

HDR_EXT := $(topdir)/src/arch/ibmpc/pce.inc $(reldir)/src/config.inc

SDP := Makefile $(HDR) $(HDR_EXT)
BDP := Makefile $(OBJ) $(OBJ_EXT)

CLN := $(OBJ) $(BIN)
DCL := Makefile

DIST := $(SRC) Makefile.in


include $(reldir)/rules.inc


all: $(BIN)


install:
	$(QR)$(INSTALL) -d -m 755 $(DESTDIR)$(datdir)/pceutils
	$(QR)for f in $(BIN) ; do \
		test x$(V) != x1 && echo "  CP     $$f" ; \
		$(INSTALL) -m 644 $$f $(DESTDIR)$(datdir)/pceutils ; \
	done


dist:
	$(QR)for f in $(BIN) ; do \
		test -f "$$f" || continue ; \
		test x$(V) != x1 && echo "  CP     $$f" ; \
		mkdir -p "$(distbase)/contrib/pceutils" ; \
		cp -p "$$f" "$(distbase)/contrib/pceutils" ; \
	done
	

%.com: %.asm
	$(QP)echo "  NASM   $@"
	$(QR)nasm -O6 -I$(reldir)/src/ -I$(topdir)/src/arch/ibmpc/ -f bin $< -o $@

%.sys: %.asm
	$(QP)echo "  NASM   $@"
	$(QR)nasm -O6 -I$(reldir)/src/ -I$(topdir)/src/arch/ibmpc/ -f bin $< -o $@


pceboot.com:	pceboot.asm $(SDP)
pceemm.sys:	pceemm.asm $(SDP)
pceexit.com:	pceexit.asm $(SDP)
pcehimem.sys:	pcehimem.asm $(SDP)
pcemsg.com:	pcemsg.asm $(SDP)
pcestop.com:	pcestop.asm $(SDP)
pcetime.com:	pcetime.asm $(SDP)
pcever.com:	pcever.asm $(SDP)
