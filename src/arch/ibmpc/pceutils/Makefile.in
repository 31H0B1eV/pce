# Makefile
# $Id$

srcdir := @srcdir@
topdir := @top_srcdir@
subdir :=
reldir := ../../../..


include $(reldir)/config.inc


BASECOM := pceboot pcecpu pceexit pceint28 pcemsg pcestop pcetime pcever
BASESYS := pceemm pcehimem

SRC := $(foreach f,$(BASECOM) $(BASESYS),$(f).asm)
HDR :=
MAN :=
BIN := $(foreach f,$(BASECOM),$(f).com)
BIN += $(foreach f,$(BASESYS),$(f).sys)

HDR_EXT := $(topdir)/src/arch/ibmpc/pce.inc $(reldir)/src/config.inc

SDP := Makefile $(HDR) $(HDR_EXT)
BDP := Makefile $(OBJ) $(OBJ_EXT)

CLN := $(OBJ) $(BIN)
DCL := Makefile


include $(reldir)/rules.inc


all: $(BIN)


install:
	$(INSTALL) -d -m 755 $(DESTDIR)$(datdir)/pce/pceutils
	$(INSTALL) -m 644 $(BIN) $(DESTDIR)$(datdir)/pce/pceutils


%.com: %.asm
	nasm -O5 -I$(reldir)/src/ -I$(topdir)/src/arch/ibmpc/ -f bin $< -o $@

%.sys: %.asm
	nasm -O5 -I$(reldir)/src/ -I$(topdir)/src/arch/ibmpc/ -f bin $< -o $@


pceboot.com:	pceboot.asm $(SDP)
pcecpu.com:	pcecpu.asm $(SDP)
pceemm.sys:	pceemm.asm $(SDP)
pceexit.com:	pceexit.asm $(SDP)
pcehimem.sys:	pcehimem.asm $(SDP)
pceint28.sys:	pceint28.asm $(SDP)
pcemsg.com:	pcemsg.asm $(SDP)
pcestop.com:	pcestop.asm $(SDP)
pcetime.com:	pcetime.asm $(SDP)
pcever.com:	pcever.asm $(SDP)
