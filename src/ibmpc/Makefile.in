# Makefile
# $Id: Makefile.in,v 1.4 2003/04/25 02:30:18 hampa Exp $

srcdir := @srcdir@
topdir := @top_srcdir@
subdir := bios
reldir := ../..
pcesrc	:= $(topdir)/src
pcedst	:= ..

include $(reldir)/Makefile.inc


SRC	:= cga.c disk.c ibmpc.c keyboard.c log.c mda.c memory.c pce.c

OBJ	:= cga.o disk.o ibmpc.o keyboard.o log.o mda.o memory.o pce.o
OBJ_EXT	:= \
	$(pcedst)/e8086/e8086.a $(pcedst)/e8255/e8255.a $(pcedst)/e8259/e8259.a \
	$(pcedst)/libini/libini.a \
	$(pcedst)/terminal/terminal.o $(pcedst)/terminal/vt100.o

HDR	:= cga.h disk.h ibmpc.h keyboard.h log.h mda.h memory.h pce.h
HDR_EXT	:= \
	$(pcesrc)/e8086/e8086.h $(pcesrc)/e8255/e8255.h $(pcesrc)/e8259/e8259.h \
	$(pcesrc)/libini/libini.h \
	$(pcesrc)/terminal/terminal.h $(pcesrc)/terminal/vt100.h

MAN	:=

BIN	:= pce

ifeq "$(PCE_X11_USE)" "1"
	OBJ_EXT += $(pcedst)/terminal/xterm.o
	HDR_EXT += $(pcesrc)/terminal/xterm.h
	CC_FLG_EXTRA := $(PCE_X11_CCF)
	LD_FLG_EXTRA := $(PCE_X11_LDF)
endif

SDP	:= Makefile $(HDR) $(HDR_EXT)
BDP	:= Makefile $(OBJ) $(OBJ_EXT)


all: $(BIN) $(OBJ) pce.cfg


clean:
	rm -f $(OBJ) $(BIN)


install:
	$(INSTALL) -d -m 755 $(bindir)
	$(INSTALL) -d -m 755 $(etcdir)
	$(INSTALL) -m 755 -s $(BIN) $(bindir)
	test -f $(etcdir)/pce.cfg || $(INSTALL) -m 644 pce.cfg $(etcdir)
ifneq "$(MAN)" ""
	$(INSTALL) -d -m 755 $(mandir)/man1
	for f in $(MAN) ; do \
		rm -f $(mandir)/man1/$$f.gz ; \
		gzip -c --best $(srcdir)/$$f > $(mandir)/man1/$$f.gz ; \
	done
endif


pce: $(OBJ) $(OBJ_EXT)
	$(LD) $(LD_FLG) $(LD_FLG_EXTRA) -o $@ $(OBJ) $(OBJ_EXT) -L/usr/X11R6/lib -lX11

pce.cfg: pce.cfg.in
	sed -e "s]PCE_DIR_DATA]$(datdir)]g" < $< > $@


cga.o:		cga.c $(SDP)
disk.o:		disk.c $(SDP)
ibmpc.o:	ibmpc.c $(SDP)
keyboard.o:	keyboard.c $(SDP)
log.o:		log.c $(SDP)
mda.o:		mda.c $(SDP)
memory.o:	memory.c $(SDP)
pce.o:		pce.c $(SDP)
